<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <arg name="launch_rviz" default="true"/>
    <arg name="load_rviz_cfg" default="true"/>
    <arg name="application_description_xacro" default="$(find evd_ros_tasks)/description/robot.urdf.xacro"/>
    <arg name="kinematics_config" default="$(find ur_description)/config/ur3_default.yaml"/>
    <arg name="config_path" default="$(find evd_ros_tasks)/config/"/>
    <arg name="config_file_name" default="ur3e_processor_config.json"/>

    <node name="test_sim" pkg="evd_ros_core" type="test_sim.py" output="screen">
        <param name="config_path" value="$(arg config_path)" />
        <param name="config_file_name" value="$(arg config_file_name)"/>
    </node>

    <param name="robot_description" command="$(find xacro)/xacro '$(arg application_description_xacro)' kinematics_config:=$(arg kinematics_config)"/>

    <node name="lively_joint_remapper" pkg="evd_ros_core" type="joint_remapper.py">
        <rosparam param="input_topics">[lively_tk/joints]</rosparam>
        <param name="output_topic" value="lively_mapped_joints"/>
        <param name="prefix" value="planner_"/>
    </node>

    <node name="pybullet_joint_remapper" pkg="evd_ros_core" type="joint_remapper.py">
        <rosparam param="input_topics">[pybullet/joints]</rosparam>
        <param name="output_topic" value="pybullet_mapped_joints"/>
        <param name="prefix" value="simulated_"/>
    </node>

    <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
        <param name="rate" value="25"/>
        <rosparam param="/source_list">[lively_mapped_joints,pybullet_mapped_joints]</rosparam>
    </node>

    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" respawn="true" output="screen" />

    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find evd_ros_tasks)/rviz/3d_printer_machine_tending.rviz"/>

</launch>