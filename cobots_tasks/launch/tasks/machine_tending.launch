<launch>

<!--=========================================================================-->
<!--  Arguements                                                             -->
<!--=========================================================================-->

  <arg name="local_physical" default="true"/>
  <arg name="local_simulated" defualt="false"/>
  <arg name="local_planner" default="false"/>

  <arg name="simulate_physical_robot" default="true"/>
  <arg name="use_cnc_serial_interface" default="false"/>

  <arg name="launch_rviz" default="true"/>
  <arg name="load_rviz_cfg" default="true"/>

<!--=========================================================================-->
<!--  CNC Device                                                             -->
<!--=========================================================================-->

  <group if="$(arg use_cnc_serial_interface)">

    <arg name="port" default="/dev/ttyACM0"/>
    <arg name="baud" value="57600"/>


    <node name="serial_bridge" pkg="rosserial_python" type="serial_node.py" output="screen">
      <param name="port" value="$(arg port)"/>
      <param name="baud" value="$(arg baud)"/>
    </node>

    <node name="fake_cnc_socket" pkg="cobots_tasks" type="fake_cnc.py"  output="screen">
      <param name="rate" value="10"/>
    </node>

  </group>

<!--=========================================================================-->
<!--  POP Button                                                             -->
<!--=========================================================================-->

<!--=========================================================================-->
<!--  Robot (All interfaces)                                      -->
<!--=========================================================================-->

  <include file="$(find cobots_core)/launch/robot.launch">
    <arg name="local_physical" value="$(arg local_physical)"/>
    <arg name="local_simulated" value="$(arg local_simulated)"/>
    <arg name="local_planner" value="$(arg local_planner)"/>
    <arg name="simulate_physical_robot" value="$(arg simulate_physical_robot)"/>
  </include>

<!--=========================================================================-->
<!--  Application                                                           -->
<!--=========================================================================-->

  <include file="$(find cobots_core)/launch/app.launch">
    <arg name="task_filepath" value="$(find cobots_tasks)/tasks/machine_tending"/>
    <arg name="ros_frame_id" value="world"/>
  </include>

  <!-- RVIZ -->
  <group if="$(arg launch_rviz)">
    <node if="$(arg load_rviz_cfg)" type="rviz" name="rviz" pkg="rviz" args="-d $(find cobots_tasks)/rviz/machine_tending.rviz"/>
    <node unless="$(arg load_rviz_cfg)" type="rviz" name="rviz" pkg="rviz"/>
  </group>

</launch>
